



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="This hands-on workshop is where you will learn about a number of AWS services involved with threat detection and response as we walk through real-world threat scenarios. Learn about the threat detection capabilities of Amazon GuardDuty, Amazon Macie and AWS Security Hub and the available response options. For each hands-on scenario, we review methods to detect and respond to threats using the following services: AWS CloudTrail, Amazon VPC flow logs, Amazon CloudWatch Events, Amazon Macie, AWS Lambda, Amazon Inspector, Amazon GuardDuty and Amazon Security Hub.">
      
      
        <link rel="canonical" href="https://automating-threat-detection.awssecworkshops.com/05-reinvent-detective/">
      
      
        <meta name="author" content="aws-security-workshops@amazon.com">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Module 5: Amazon Detective - Scaling threat detection and response in AWS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.0284f74d.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#module-5-amazon-detective" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">
  
        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>
  
        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>
  
        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  Scaling threat detection and response in AWS
                </span>
                <span class="md-header-nav__topic">
                  Module 5: Amazon Detective
                </span>
              
            
          </div>
        </div>
        
        
        <!-- Button to open search dialogue -->
        <!--
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>
  
              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>

         -->
         
         <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-flex__ellipsis md-header-nav__lang">
                <div>
                    <button onclick="window.location.href = 'https://awssecworkshops.com/';" class="md-lang-dropbtn fa fa-home"></button>
                </div>
            </div>
        </div>
  
        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              


  

<a href="https://github.com/awsrossw/aws-scaling-threat-detection-workshop/tree/EventEngine/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    awsrossw/aws-scaling-threat-detection-workshop
  </div>
</a>
            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="Overview" class="md-tabs__link md-tabs__link--active">
        Overview
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2019 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Main navigation -->
<nav class="md-nav md-nav--primary" data-md-level="0">

  <!-- Site title -->
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://automating-threat-detection.awssecworkshops.com/"
        title="Scaling threat detection and response in AWS" class="md-nav__button md-logo">
      
        <img src="../assets/images/aws_smile_logo.png" width="48" height="48" />
      
    </a>
    Scaling threat detection
  </label>

  <!-- Repository containing source -->
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/awsrossw/aws-scaling-threat-detection-workshop/tree/EventEngine/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    awsrossw/aws-scaling-threat-detection-workshop
  </div>
</a>
    </div>
  

  <!-- Render item list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../01-environment-setup/" title="Module 1: Environment Build" class="md-nav__link">
      Module 1: Environment Build
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../02-attack-simulation/" title="Module 2: Attack Simulation" class="md-nav__link">
      Module 2: Attack Simulation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../03-detection-and-remediation/" title="Module 3: Detect & Respond" class="md-nav__link">
      Module 3: Detect & Respond
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../04-review-and-discussion/" title="Module 4: Discussion" class="md-nav__link">
      Module 4: Discussion
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contribute/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#switch-roles-to-detective-demo-account" title="Switch Roles to Detective Demo account" class="md-nav__link">
    Switch Roles to Detective Demo account
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#change-region" title="Change Region" class="md-nav__link">
    Change Region
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-with-amazon-guardduty" title="Start with Amazon GuardDuty" class="md-nav__link">
    Start with Amazon GuardDuty
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#investigate-with-amazon-detective" title="Investigate with Amazon Detective" class="md-nav__link">
    Investigate with Amazon Detective
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-did-you-find-prizes" title="What did you find = Prizes!" class="md-nav__link">
    What did you find = Prizes!
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-happened-during-the-scenario" title="What happened during the scenario?" class="md-nav__link">
    What happened during the scenario?
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/awsrossw/aws-scaling-threat-detection-workshop/tree/EventEngine/edit/master/docs/05-reinvent-detective.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="module-5-amazon-detective">Module 5: Amazon Detective</h1>
<p>This is a re:invent 2019 only module. For the rest of this session you will have hands on time with the new investigative service, <strong>Amazon Detective</strong>, that is currently in gated preview. </p>
<p><strong>Note</strong> This module is separate from each of the previous modules and involves separate infrastructure, accounts and attack vectors, but do not log out of the account you were using. </p>
<p><strong>Agenda</strong></p>
<ol>
<li>Switch Roles to Demo Account</li>
<li>Start with a Amazon GuardDuty finding</li>
<li>Investigate with Amazon Detective</li>
<li>What did you find = Prizes!</li>
<li>What happened ? - Scenario discussion</li>
</ol>
<h3 id="switch-roles-to-detective-demo-account">Switch Roles to Detective Demo account</h3>
<p>In same browser were you are logged in, go this URL:</p>
<p><nobr><a href="https://signin.aws.amazon.com/switchrole?roleName=WorkshopReadOnly&amp;account=549639478491">https://signin.aws.amazon.com/switchrole?roleName=WorkshopReadOnly&amp;account=549639478491</a></nobr></p>
<div class="admonition note">
<p class="admonition-title">Attention: Multiple Roles available</p>
<p>You will need to change <code>WorkshopReadOnly</code> to one of the following
 <code>WorkshopReadOnly-1</code>
 <code>WorkshopReadOnly-2</code>
 <code>WorkshopReadOnly-3</code>
 <code>WorkshopReadOnly-4</code>
 You may have to try more than one role.</p>
</div>
<p><img alt="SwitchRole" src="../images/05-switchrolelogin.png" /></p>
<p>After you make the changes to the <code>Role</code> field, click <code>Switch Role</code> to login to that role in the Demo Account. You may have to try more than one role.</p>
<h3 id="change-region">Change Region</h3>
<p>Amazon detective is only available in 5 regions at launch. For this workshop you will be using the <code>US East (N. Virginia)us-east-1</code> region, please select this region from the dropdown in the upper right hand of your AWS Console.</p>
<h3 id="start-with-amazon-guardduty">Start with Amazon GuardDuty</h3>
<p>You will initiate your investigation from an AWS detection source, in this case, Amazon GuardDuty. As a security analyst you will be familiar with multiple attack vectors, but for this scenario, we are going to start with a high severity cryptocurrency finding and pivot into Detective to leverage it’s analytical power to discover the scope and depth of an attacker’s foothold in your workloads.</p>
<div class="admonition info">
<p class="admonition-title">You can do this section at your own pace or follow along with the presenter</p>
</div>
<p>Go to the GuardDuty console and select the <code>Crypto_Mining_Finding_Types</code> saved filter from the drop down menu in the upper right hand corner. Select, click the checkbox, for the <code>CryptoCurrency:EC2/BitcoinTool.B</code> finding with the resource that has <nobr><code>i-0441b8673fab0f671</code></nobr> as the instance ID.</p>
<p>Finally, using the <code>Actions</code> tab, select the drop down and select <code>Investigate</code>. </p>
<p><img alt="Investigate" src="../images/05-01-Investigate.png" /></p>
<p>You are now utilizing the deep integration between the various AWS security services to pivot from GuardDuty as your entry point into Detective. </p>
<div class="admonition info">
<p class="admonition-title">Remember we are playing the part of a security analyst. Take good notes.</p>
</div>
<h3 id="investigate-with-amazon-detective">Investigate with Amazon Detective</h3>
<p>Let's review the finding profile of the selected finding.  Any time you see the small blue <code>info</code> link, next to a panel heading, you can click to enable more information in the right hand sidebar. </p>
<p><img alt="Finding" src="../images/05-02-Finding1.png" /></p>
<div class="admonition info">
<p class="admonition-title">Review the information in GuardDuty finding details panel, instance details.</p>
</div>
<div class="admonition question">
<p class="admonition-title">Did you notice the 'Edit' button next to scope time? This will be important very soon!</p>
</div>
<p>Scroll down to the <code>Findings associated with Ec2Instance</code> panel.</p>
<p><img alt="Associated" src="../images/05-03-Associated.png" /></p>
<p>As a security analysts we are always interested what other findings are associated with the resources we are investigating, this is just one part of enabling a unified view of user and resource interactions over time.</p>
<p>Next Scroll down to <code>Overall VPCflow</code> panel click on the <code>info</code> link for an explanation of what you are seeing in the panel.</p>
<p><img alt="IPAddress" src="../images/05-04-IPAddress.png" />
We are looking at the VPCflow volume for this specific instance. Observe that there is a relatively short time period of volume based on the what we observe in the time series panel data.  Most likely this instance was recently spun up.</p>
<p>Scroll back up to the top of the page and click on the <code>VPC flow details</code> tab.  Take note of the <code>Remote IP address</code> in this panel. <!--and explain that we are looking at any IP addresses associated with this finding.  Take a note of the IP address and add it to our analyst notes.  We want to include any IoCs in our investigation and keep track of all impacted resource. --></p>
<p>Let's now determine if any other instances are communicating with this IP address.  Right click on the IP address and open the link in a different tab.  Here we are trying to scope the depth and breath of what other footholds the attacker might have in your network.</p>
<p><img alt="IPAddress2" src="../images/05-05-IPAddress2.png" /></p>
<p>After switching to the new browser tab, scroll down to the <code>Findings associated with IP address</code> panel, we observe additional findings related with this IP address.  In your investigation you should note any other instances that are talking to this bitcoin mining IP address for a possible secondary investigation. <!--(Note: The Findings associated with IP address panel currently shows historical GuardDuty findings even the ones I archived).  --></p>
<p><img alt="IPDetails" src="../images/05-06-IPAddressdetails.png" /></p>
<p>After you have written down all of the instances impacted in the current investigation, we will want to determine the credentials used to spin up these instances.  On our original browser tab, go back to the <code>Overview tab</code> and scroll down to the <code>EC2 instance details</code> panel and look for the <code>Created by</code> field.  This shows us what role was associated with this finding and what user’s credentials might have been compromised. <!--(Note:  We will need to explain that the naming convention for the role is associated with AWS SSO roles and is also a federated role type.)
--></p>
<p><img alt="SSOROle" src="../images/05-07-SSORole.png" /></p>
<p>It is important to realize that we are pivoting from a VPCflow data source (IP Addresses information) to a Cloudtrail data source (EC2 Instance Created By Role information). Amazon Detective makes this simple, seamless transition by having access to the metadata associated with the each data source.</p>
<p>Right click on the link under the <code>Created by</code> header and open in a new tab.</p>
<p>On the <code>Role details</code> panel scroll down to the <code>Overall API call volume</code> panel. </p>
<div class="admonition note">
<p class="admonition-title">Note: There is activity before the current scoping time.  The current timeframe includes the past 24 hours but by using the time series graph we can focus our investigation to include a select time window of the activity</p>
</div>
<!--Explain the time series graph with the black box which means that our current time frame needs to be expanded to include all activity.!-->

<p>We will increase the scope time of this investigation to include some of the previous activity and then lock the time frame with the toggle so the scope time persists during the rest of the investigation. </p>
<p><img alt="Text" src="../images/05-09-RoleFindings.png" /></p>
<p>Click on the <code>Edit</code> button right below <code>Scope time</code> in the upper right hand corner and change the <code>Start</code> window to <strong><em><code>2019/11/14</code></em></strong>, toggle the lock slider and select <code>Update scope time</code></p>
<p><img alt="ScopeTime" src="../images/05-scopetime.png" /></p>
<p>We can now see there are additional findings associated with this user role after expanding our time frame. Note the expanded black box in the <code>Overall API call volume</code> panel.
<img alt="Text" src="../images/05-11-Scopetime-Findings.png" /></p>
<p>Our next step is to determine if there is any new behavior with this user role.  </p>
<p>Select the <code>New Behavior</code> tab and observe the <code>Newly observed geolocations</code> and what it is showing.</p>
<p><img alt="Text" src="../images/05-12-Geolocations-Map.png" /></p>
<div class="admonition note">
<p class="admonition-title">Take note of the Newly observed and Previously observed highlights and the actual locations (Ukraine, Estonia, and Romania)</p>
</div>
<p>By selecting one of the circles on the map or selecting the <code>Details</code> link on the right hand side of the panel, observe the IP addresses associated with each country and take a note of them in your analyst notes.  We use these IP addresses as Indicators of Compromise (IoCs) in our investigation of Cloudtail logs. </p>
<!--![Text](./images/05-13-Geolocations-Map-Drilldown.png)-->

<p><img alt="Text" src="../images/05-14-Geolocations-APICalls.png" /></p>
<p>This is a great time to checkout some of the API calls in this timeframe that are associated with these IP addresses.  Observe the impacted resources/services but not we don’t need them to write them down for this workshop.</p>
<p>Next, we are going to take a look at <code>Newly observed user agents</code> panel down at the very bottom of this AWS Role page.</p>
<p>Take note of the super suspicious user agent and expand out the time series graph to determine the timeframe of activity.  The activity aligns with our current scoping time so we don’t need to adjust it further. </p>
<p><img alt="Text" src="../images/05-15-Geolocations-UserAgent.png" /></p>
<div class="admonition note">
<p class="admonition-title">Are all these User Agents legitimate? Or do some look suspicious? Remember take good notes.</p>
</div>
<p>Next open the <code>Im the adversary. Catch me if you can</code> user agent in a new tab, by right clicking and selecting 'Open Link in new Tab'.  Here we are once again pivoting on another field in the Cloudtrail metadata source to get any other IoCs or impacted resources. </p>
<p><img alt="Text" src="../images/05-16-CatchMe.png" /></p>
<p>Once we pivot over to the user agent panel, select the <code>Resource interaction</code> tab and take note of the activity.  Notice that there appears to be more than one impacted user.  Most likely an indication that the attacker created a user(s) with long lived credentials for persistence in your environment.</p>
<p><img alt="Text" src="../images/05-17-CatchMe-Resources.png" /></p>
<h3 id="what-did-you-find-prizes">What did you find = Prizes!</h3>
<p>Be prepared to discuss what IoCs you found:
 Any suspicious IP Addresses, User agents, instance IDs or users</p>
<h3 id="what-happened-during-the-scenario">What happened during the scenario?</h3>
<details class="note"><summary>Are you curious about what happened, open this drop down</summary><p><img alt="What" src="../images/05-whathappend.png" /></p>
</details>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://awssecworkshops.com" class="md-footer-social__link fa fa-home"></a>
    
      <a href="https://aws.amazon.com/security/" class="md-footer-social__link fa fa-shield"></a>
    
      <a href="https://twitter.com/awssecurityinfo?lang=en" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://aws.amazon.com/blogs/security/" class="md-footer-social__link fa fa-rss"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>